<h1>Edit Inventory Item</h1>
<%- messages() %>
    <% if (typeof errors !=='undefined' && errors) { %>
        <ul class="notice">
            <% errors.array().forEach(error=> { %>
                <li>
                    <%= error.msg %>
                </li>
                <% }) %>
        </ul>
        <% } %>
            <div class="form-container">
                <form id="updateForm" action="/inv/update" method="post" onsubmit="return validateForm(event)">
                    <label for="classification_id">Classification:</label>
                    <%- classificationSelect %>
                        <label for="inv_make">Make:</label>
                        <input type="text" id="inv_make" name="inv_make" required
                            value="<%= typeof inv_make !== 'undefined' ? inv_make : '' %>">
                        <label for="inv_model">Model:</label>
                        <input type="text" id="inv_model" name="inv_model" required
                            value="<%= typeof inv_model !== 'undefined' ? inv_model : '' %>">
                        <label for="inv_year">Year:</label>
                        <input type="text" id="inv_year" name="inv_year" required pattern="\d{4}"
                            title="Enter a 4-digit year" value="<%= typeof inv_year !== 'undefined' ? inv_year : '' %>">
                        <label for="inv_description">Description:</label>
                        <textarea id="inv_description" name="inv_description"
                            required><%= typeof inv_description !== 'undefined' ? inv_description : '' %></textarea>
                        <label for="inv_image">Image Path:</label>
                        <input type="text" id="inv_image" name="inv_image" required
                            value="<%= typeof inv_image !== 'undefined' ? inv_image : '/images/vehicles/no-image.png' %>">
                        <label for="inv_thumbnail">Thumbnail Path:</label>
                        <input type="text" id="inv_thumbnail" name="inv_thumbnail" required
                            value="<%= typeof inv_thumbnail !== 'undefined' ? inv_thumbnail : '/images/vehicles/no-image-tn.png' %>">
                        <label for="inv_price">Price:</label>
                        <input type="number" id="inv_price" name="inv_price" required min="0" step="0.01"
                            value="<%= typeof inv_price !== 'undefined' ? inv_price : '' %>">
                        <label for="inv_miles">Miles:</label>
                        <input type="number" id="inv_miles" name="inv_miles" required min="0" step="1"
                            value="<%= typeof inv_miles !== 'undefined' ? inv_miles : '' %>">
                        <label for="inv_color">Color:</label>
                        <input type="text" id="inv_color" name="inv_color" required
                            value="<%= typeof inv_color !== 'undefined' ? inv_color : '' %>">
                        <input type="hidden" name="inv_id"
                            value="<%= typeof inv_id !== 'undefined' ? inv_id : (locals.inv_id || '') %>">
                        <div id="error-message"></div>
                        <button type="submit" disabled>Update Vehicle</button>
                </form>
            </div>
            <script>
                // Client-side validation for all fields
                function validateForm(event) {
                    let valid = true;
                    let errorMsg = '';
                    // Required fields
                    const requiredFields = [
                        'inv_make', 'inv_model', 'inv_year', 'inv_description', 'inv_image', 'inv_thumbnail', 'inv_price', 'inv_miles', 'inv_color', 'classification_id'
                    ];
                    requiredFields.forEach(function (field) {
                        const el = document.getElementById(field);
                        if (!el.value) {
                            valid = false;
                            errorMsg += field.replace('inv_', '').replace('_', ' ') + ' is required. ';
                        }
                    });
                    // Year validation
                    const year = document.getElementById('inv_year').value;
                    if (!/^\d{4}$/.test(year)) {
                        valid = false;
                        errorMsg += 'Year must be a 4-digit number. ';
                    }
                    // Price validation
                    const price = document.getElementById('inv_price').value;
                    if (isNaN(price) || Number(price) <= 0) {
                        valid = false;
                        errorMsg += 'Price must be a positive number. ';
                    }
                    // Miles validation
                    const miles = document.getElementById('inv_miles').value;
                    if (isNaN(miles) || Number(miles) < 0) {
                        valid = false;
                        errorMsg += 'Miles must be a non-negative number. ';
                    }
                    if (!valid) {
                        event.preventDefault();
                        document.getElementById('error-message').textContent = errorMsg;
                    } else {
                        document.getElementById('error-message').textContent = '';
                    }
                    return valid;
                }
            </script>
            <script src="/js/inv-update.js"></script>